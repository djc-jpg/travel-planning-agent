{
  "generated_at": "2026-02-22T20:56:47",
  "passed": true,
  "scenarios": [
    {
      "name": "degraded_baseline",
      "description": "No external keys in non-strict mode still returns DEGRADED response.",
      "passed": true,
      "detail": "status_code=200, status=done, run_mode=DEGRADED",
      "elapsed_ms": 36332.84,
      "evidence": {
        "status_code": 200,
        "body": {
          "status": "done",
          "message": "åŒ—äº¬2å¤©è¡Œç¨‹äº®ç‚¹ï¼šç¬¬1å¤©ï¼šå¤©å®‰é—¨å¹¿åœºã€å¤©å®‰é—¨åŸæ¥¼ã€æ•…å®«åšç‰©é™¢ï¼›ç¬¬2å¤©ï¼šæ­£é˜³é—¨åŸæ¥¼ã€æ™¯å±±å…¬å›­ã€åŒ—æµ·å…¬å›­",
          "itinerary": {
            "city": "åŒ—äº¬",
            "days": [
              {
                "day_number": 1,
                "date": "2026-04-01",
                "schedule": [
                  {
                    "poi": {
                      "id": "bj_tiananmen_square",
                      "name": "å¤©å®‰é—¨å¹¿åœº",
                      "city": "åŒ—äº¬",
                      "lat": 39.903018,
                      "lon": 116.397624,
                      "themes": [
                        "å†å²",
                        "åœ°æ ‡"
                      ],
                      "duration_hours": 1.5,
                      "cost": 0.0,
                      "indoor": false,
                      "open_time": "05:00-22:00",
                      "description": "å‡æ——æ—¶æ®µäººæµæé«˜ï¼Œå»ºè®®é”™å³°14:00åè¿›å…¥ã€‚",
                      "requires_reservation": true,
                      "reservation_days_ahead": 1,
                      "closed_rules": "é‡å¤§æ´»åŠ¨å¯èƒ½ä¸´æ—¶ç®¡æ§",
                      "closed_weekdays": [],
                      "source_category": "",
                      "ticket_price": 0.0,
                      "open_hours": "05:00-22:00",
                      "reservation_required": true,
                      "semantic_type": "experience",
                      "semantic_confidence": 0.85
                    },
                    "time_slot": "morning",
                    "start_time": "08:47",
                    "end_time": "10:17",
                    "travel_minutes": 0.0,
                    "buffer_minutes": 17.0,
                    "notes": "reservation_required",
                    "is_backup": false
                  },
                  {
                    "poi": {
                      "id": "bj_tiananmen_tower",
                      "name": "å¤©å®‰é—¨åŸæ¥¼",
                      "city": "åŒ—äº¬",
                      "lat": 39.907085,
                      "lon": 116.397483,
                      "themes": [
                        "å†å²",
                        "åœ°æ ‡"
                      ],
                      "duration_hours": 1.0,
                      "cost": 15.0,
                      "indoor": false,
                      "open_time": "08:30-16:30",
                      "description": "éœ€æºå¸¦æœ‰æ•ˆè¯ä»¶ï¼Œå®‰æ£€æ’é˜Ÿå»ºè®®é¢„ç•™40åˆ†é’Ÿã€‚",
                      "requires_reservation": true,
                      "reservation_days_ahead": 3,
                      "closed_rules": "æç«¯å¤©æ°”ä¸é‡å¤§æ´»åŠ¨å¯èƒ½åœå¼€",
                      "closed_weekdays": [],
                      "source_category": "",
                      "ticket_price": 15.0,
                      "open_hours": "08:30-16:30",
                      "reservation_required": true,
                      "semantic_type": "experience",
                      "semantic_confidence": 0.85
                    },
                    "time_slot": "morning",
                    "start_time": "10:46",
                    "end_time": "11:46",
                    "travel_minutes": 15.3,
                    "buffer_minutes": 14.0,
                    "notes": "reservation_required",
                    "is_backup": false
                  },
                  {
                    "poi": {
                      "id": "bj_forbidden_city",
                      "name": "æ•…å®«åšç‰©é™¢",
                      "city": "åŒ—äº¬",
                      "lat": 39.916345,
                      "lon": 116.397155,
                      "themes": [
                        "å†å²",
                        "æ–‡åŒ–"
                      ],
                      "duration_hours": 3.0,
                      "cost": 60.0,
                      "indoor": false,
                      "open_time": "08:30-17:00",
                      "description": "æ˜¥èŠ‚é«˜å³°å»ºè®®08:30å‰å…¥åœºï¼Œé¢„ç•™å®‰æ£€ä¸æ£€ç¥¨ç¼“å†²ã€‚",
                      "requires_reservation": true,
                      "reservation_days_ahead": 7,
                      "closed_rules": "å‘¨ä¸€é—­é¦†ï¼ˆæ³•å®šèŠ‚å‡æ—¥é™¤å¤–ï¼‰",
                      "closed_weekdays": [
                        0
                      ],
                      "source_category": "",
                      "ticket_price": 60.0,
                      "open_hours": "08:30-17:00",
                      "reservation_required": true,
                      "semantic_type": "experience",
                      "semantic_confidence": 0.85
                    },
                    "time_slot": "lunch",
                    "start_time": "13:18",
                    "end_time": "16:18",
                    "travel_minutes": 17.6,
                    "buffer_minutes": 26.0,
                    "notes": "reservation_required",
                    "is_backup": false
                  }
                ],
                "backups": [
                  {
                    "poi": {
                      "id": "bj_zhongshan_park",
                      "name": "ä¸­å±±å…¬å›­",
                      "city": "åŒ—äº¬",
                      "lat": 39.908723,
                      "lon": 116.392708,
                      "themes": [
                        "å†å²",
                        "å›­æ—"
                      ],
                      "duration_hours": 1.5,
                      "cost": 3.0,
                      "indoor": false,
                      "open_time": "06:00-21:00",
                      "description": "é€‚åˆä½œä¸ºå¤©å®‰é—¨åŒºåŸŸé”™å³°æ›¿ä»£ç‚¹ã€‚",
                      "requires_reservation": false,
                      "reservation_days_ahead": 0,
                      "closed_rules": "èŠ±å±•æœŸé—´éƒ¨åˆ†åŒºåŸŸé™æµ",
                      "closed_weekdays": [],
                      "source_category": "",
                      "ticket_price": 3.0,
                      "open_hours": "06:00-21:00",
                      "reservation_required": false,
                      "semantic_type": "experience",
                      "semantic_confidence": 0.85
                    },
                    "time_slot": "afternoon",
                    "start_time": null,
                    "end_time": null,
                    "travel_minutes": 0.0,
                    "buffer_minutes": 0.0,
                    "is_backup": true
                  }
                ],
                "day_summary": "å¤©æ°”:æ™´",
                "estimated_cost": 294.0,
                "total_travel_minutes": 32.9,
                "meal_windows": [
                  "12:30-13:18"
                ]
              },
              {
                "day_number": 2,
                "date": "2026-04-02",
                "schedule": [
                  {
                    "poi": {
                      "id": "bj_zhengyangmen_tower",
                      "name": "æ­£é˜³é—¨åŸæ¥¼",
                      "city": "åŒ—äº¬",
                      "lat": 39.899128,
                      "lon": 116.396756,
                      "themes": [
                        "å†å²",
                        "åœ°æ ‡"
                      ],
                      "duration_hours": 1.0,
                      "cost": 20.0,
                      "indoor": false,
                      "open_time": "09:00-17:00",
                      "description": "ä¸å‰é—¨æ­¥è¡Œè¡—å¯ä¸²è”ï¼Œå»ºè®®15:00å‰å…¥åœºã€‚",
                      "requires_reservation": false,
                      "reservation_days_ahead": 0,
                      "closed_rules": "å‘¨ä¸€é—­é¦†ï¼ˆèŠ‚å‡æ—¥é™¤å¤–ï¼‰",
                      "closed_weekdays": [
                        0
                      ],
                      "source_category": "",
                      "ticket_price": 20.0,
                      "open_hours": "09:00-17:00",
                      "reservation_required": false,
                      "semantic_type": "experience",
                      "semantic_confidence": 0.85
                    },
                    "time_slot": "morning",
                    "start_time": "09:00",
                    "end_time": "10:00",
                    "travel_minutes": 0.0,
                    "buffer_minutes": 10.0,
                    "is_backup": false
                  },
                  {
                    "poi": {
                      "id": "bj_jingshan",
                      "name": "æ™¯å±±å…¬å›­",
                      "city": "åŒ—äº¬",
                      "lat": 39.923236,
                      "lon": 116.396144,
                      "themes": [
                        "å†å²",
                        "è‡ªç„¶"
                      ],
                      "duration_hours": 1.5,
                      "cost": 2.0,
                      "indoor": false,
                      "open_time": "06:30-21:00",
                      "description": "é€‚åˆå‚æ™šç™»é¡¶æ‹æ‘„æ•…å®«å…¨æ™¯ã€‚",
                      "requires_reservation": false,
                      "reservation_days_ahead": 0,
                      "closed_rules": "æç«¯å¤©æ°”å¯èƒ½ä¸´æ—¶å…³é—­åˆ¶é«˜ç‚¹åŒºåŸŸ",
                      "closed_weekdays": [],
                      "source_category": "",
                      "ticket_price": 2.0,
                      "open_hours": "06:30-21:00",
                      "reservation_required": false,
                      "semantic_type": "experience",
                      "semantic_confidence": 0.85
                    },
                    "time_slot": "morning",
                    "start_time": "10:48",
                    "end_time": "12:18",
                    "travel_minutes": 37.7,
                    "buffer_minutes": 10.0,
                    "is_backup": false
                  },
                  {
                    "poi": {
                      "id": "bj_beihai",
                      "name": "åŒ—æµ·å…¬å›­",
                      "city": "åŒ—äº¬",
                      "lat": 39.925639,
                      "lon": 116.389526,
                      "themes": [
                        "å†å²",
                        "å›­æ—",
                        "è‡ªç„¶"
                      ],
                      "duration_hours": 2.0,
                      "cost": 10.0,
                      "indoor": false,
                      "open_time": "06:00-21:00",
                      "description": "æ˜¥èŠ‚æ¸¸èˆ¹é¡¹ç›®å¯èƒ½æ’é˜Ÿï¼Œå»ºè®®é¿å¼€åˆåé«˜å³°ã€‚",
                      "requires_reservation": false,
                      "reservation_days_ahead": 0,
                      "closed_rules": "å†°é¢ä¸éƒ¨åˆ†åŒºåŸŸæŒ‰å­£èŠ‚ç®¡æ§",
                      "closed_weekdays": [],
                      "source_category": "",
                      "ticket_price": 10.0,
                      "open_hours": "06:00-21:00",
                      "reservation_required": false,
                      "semantic_type": "experience",
                      "semantic_confidence": 0.85
                    },
                    "time_slot": "afternoon",
                    "start_time": "13:41",
                    "end_time": "15:41",
                    "travel_minutes": 23.2,
                    "buffer_minutes": 12.0,
                    "is_backup": false
                  }
                ],
                "backups": [
                  {
                    "poi": {
                      "id": "bj_lao_she_memorial",
                      "name": "è€èˆæ•…å±…",
                      "city": "åŒ—äº¬",
                      "lat": 39.925167,
                      "lon": 116.417442,
                      "themes": [
                        "å†å²",
                        "æ–‡åŒ–"
                      ],
                      "duration_hours": 1.0,
                      "cost": 0.0,
                      "indoor": false,
                      "open_time": "09:00-16:30",
                      "description": "é—­é¦†å‰1å°æ—¶åœæ­¢å…¥åœºã€‚",
                      "requires_reservation": false,
                      "reservation_days_ahead": 0,
                      "closed_rules": "å‘¨ä¸€é—­é¦†",
                      "closed_weekdays": [
                        0
                      ],
                      "source_category": "",
                      "ticket_price": 0.0,
                      "open_hours": "09:00-16:30",
                      "reservation_required": false,
                      "semantic_type": "experience",
                      "semantic_confidence": 0.85
                    },
                    "time_slot": "afternoon",
                    "start_time": null,
                    "end_time": null,
                    "travel_minutes": 0.0,
                    "buffer_minutes": 0.0,
                    "is_backup": true
                  }
                ],
                "day_summary": "å¤©æ°”:æ™´",
                "estimated_cost": 208.0,
                "total_travel_minutes": 60.9,
                "meal_windows": [
                  "12:53-13:41"
                ]
              }
            ],
            "total_cost": 502.0,
            "assumptions": [
              "preference_reranked=true",
              "persona=default max_pois=5",
              "persona_profile=default",
              "day_template_diversity:ä¸­å±±å…¬å›­->æ­£é˜³é—¨åŸæ¥¼",
              "routing_confidence=0.90"
            ],
            "summary": "åŒ—äº¬2å¤©è¡Œç¨‹äº®ç‚¹ï¼šç¬¬1å¤©ï¼šå¤©å®‰é—¨å¹¿åœºã€å¤©å®‰é—¨åŸæ¥¼ã€æ•…å®«åšç‰©é™¢ï¼›ç¬¬2å¤©ï¼šæ­£é˜³é—¨åŸæ¥¼ã€æ™¯å±±å…¬å›­ã€åŒ—æµ·å…¬å›­",
            "budget_breakdown": {
              "tickets": 214.0,
              "local_transport": 48.0,
              "food_min": 240.0
            },
            "budget_source_breakdown": {
              "tickets": "curated",
              "local_transport": "heuristic",
              "food_min": "heuristic"
            },
            "budget_confidence_breakdown": {
              "tickets": 0.85,
              "local_transport": 0.55,
              "food_min": 0.55
            },
            "budget_confidence_score": 0.6779,
            "budget_as_of": "2026-02-22",
            "minimum_feasible_budget": 502.0,
            "budget_warning": ""
          },
          "session_id": "0e31eb6c",
          "request_id": "24067223-dd9",
          "trace_id": "0010ea52-649",
          "degrade_level": "L1",
          "confidence_score": 0.7,
          "issues": [],
          "next_questions": [],
          "field_evidence": {
            "city": {
              "field": "city",
              "source": "user_text",
              "value": "åŒ—äº¬"
            },
            "days": {
              "field": "days",
              "source": "user_text",
              "value": 2
            },
            "date_start": {
              "field": "date_start",
              "source": "user_form",
              "value": "2026-04-01"
            },
            "date_end": {
              "field": "date_end",
              "source": "user_form",
              "value": "2026-04-02"
            }
          },
          "run_fingerprint": {
            "run_mode": "DEGRADED",
            "poi_provider": "amap",
            "route_provider": "fixture",
            "llm_provider": "dashscope",
            "strict_external_data": false,
            "env_source": ".env",
            "trace_id": "0010ea52-649"
          }
        }
      }
    },
    {
      "name": "strict_external_fail_fast",
      "description": "Strict external mode without keys must fail fast with controlled error.",
      "passed": true,
      "detail": "status_code=422, detail=æŠ±æ­‰ï¼Œé‡åˆ°äº†æ„æ–™ä¹‹å¤–çš„é—®é¢˜ï¼Œè¯·ç¨åé‡è¯•æˆ–æ¢ä¸ªè¯´æ³•æè¿°éœ€æ±‚ã€‚\n\nğŸ’¡ ä½ å¯ä»¥è¯•è¯•ï¼š\n  â€¢ 'æˆ‘æƒ³å»åŒ—äº¬ç©3å¤©ï¼Œå–œæ¬¢å†å²å’Œç¾é£Ÿ'\n  â€¢ 'æ­å·2æ—¥æ¸¸ï¼Œé¢„ç®—æ¯å¤©500å…ƒ'\n  â€¢ 'æˆéƒ½5å¤©äº²å­æ¸¸ï¼Œè½»æ¾èŠ‚å¥'",
      "elapsed_ms": 8306.51,
      "evidence": {
        "status_code": 422,
        "body": {
          "detail": "æŠ±æ­‰ï¼Œé‡åˆ°äº†æ„æ–™ä¹‹å¤–çš„é—®é¢˜ï¼Œè¯·ç¨åé‡è¯•æˆ–æ¢ä¸ªè¯´æ³•æè¿°éœ€æ±‚ã€‚\n\nğŸ’¡ ä½ å¯ä»¥è¯•è¯•ï¼š\n  â€¢ 'æˆ‘æƒ³å»åŒ—äº¬ç©3å¤©ï¼Œå–œæ¬¢å†å²å’Œç¾é£Ÿ'\n  â€¢ 'æ­å·2æ—¥æ¸¸ï¼Œé¢„ç®—æ¯å¤©500å…ƒ'\n  â€¢ 'æˆéƒ½5å¤©äº²å­æ¸¸ï¼Œè½»æ¾èŠ‚å¥'"
        }
      }
    },
    {
      "name": "tool_timeout_fault",
      "description": "Injected upstream timeout should produce controlled 4xx business failure (not 5xx).",
      "passed": true,
      "detail": "status_code=422, detail=æŠ±æ­‰ï¼Œé‡åˆ°äº†æ„æ–™ä¹‹å¤–çš„é—®é¢˜ï¼Œè¯·ç¨åé‡è¯•æˆ–æ¢ä¸ªè¯´æ³•æè¿°éœ€æ±‚ã€‚\n\nğŸ’¡ ä½ å¯ä»¥è¯•è¯•ï¼š\n  â€¢ 'æˆ‘æƒ³å»åŒ—äº¬ç©3å¤©ï¼Œå–œæ¬¢å†å²å’Œç¾é£Ÿ'\n  â€¢ 'æ­å·2æ—¥æ¸¸ï¼Œé¢„ç®—æ¯å¤©500å…ƒ'\n  â€¢ 'æˆéƒ½5å¤©äº²å­æ¸¸ï¼Œè½»æ¾èŠ‚å¥'",
      "elapsed_ms": 27567.15,
      "evidence": {
        "status_code": 422,
        "body": {
          "detail": "æŠ±æ­‰ï¼Œé‡åˆ°äº†æ„æ–™ä¹‹å¤–çš„é—®é¢˜ï¼Œè¯·ç¨åé‡è¯•æˆ–æ¢ä¸ªè¯´æ³•æè¿°éœ€æ±‚ã€‚\n\nğŸ’¡ ä½ å¯ä»¥è¯•è¯•ï¼š\n  â€¢ 'æˆ‘æƒ³å»åŒ—äº¬ç©3å¤©ï¼Œå–œæ¬¢å†å²å’Œç¾é£Ÿ'\n  â€¢ 'æ­å·2æ—¥æ¸¸ï¼Œé¢„ç®—æ¯å¤©500å…ƒ'\n  â€¢ 'æˆéƒ½5å¤©äº²å­æ¸¸ï¼Œè½»æ¾èŠ‚å¥'"
        }
      }
    },
    {
      "name": "tool_rate_limit_fault",
      "description": "Injected upstream 429 should produce controlled business failure (not crash).",
      "passed": true,
      "detail": "status_code=422, detail=æŠ±æ­‰ï¼Œé‡åˆ°äº†æ„æ–™ä¹‹å¤–çš„é—®é¢˜ï¼Œè¯·ç¨åé‡è¯•æˆ–æ¢ä¸ªè¯´æ³•æè¿°éœ€æ±‚ã€‚\n\nğŸ’¡ ä½ å¯ä»¥è¯•è¯•ï¼š\n  â€¢ 'æˆ‘æƒ³å»åŒ—äº¬ç©3å¤©ï¼Œå–œæ¬¢å†å²å’Œç¾é£Ÿ'\n  â€¢ 'æ­å·2æ—¥æ¸¸ï¼Œé¢„ç®—æ¯å¤©500å…ƒ'\n  â€¢ 'æˆéƒ½5å¤©äº²å­æ¸¸ï¼Œè½»æ¾èŠ‚å¥'",
      "elapsed_ms": 29057.45,
      "evidence": {
        "status_code": 422,
        "body": {
          "detail": "æŠ±æ­‰ï¼Œé‡åˆ°äº†æ„æ–™ä¹‹å¤–çš„é—®é¢˜ï¼Œè¯·ç¨åé‡è¯•æˆ–æ¢ä¸ªè¯´æ³•æè¿°éœ€æ±‚ã€‚\n\nğŸ’¡ ä½ å¯ä»¥è¯•è¯•ï¼š\n  â€¢ 'æˆ‘æƒ³å»åŒ—äº¬ç©3å¤©ï¼Œå–œæ¬¢å†å²å’Œç¾é£Ÿ'\n  â€¢ 'æ­å·2æ—¥æ¸¸ï¼Œé¢„ç®—æ¯å¤©500å…ƒ'\n  â€¢ 'æˆéƒ½5å¤©äº²å­æ¸¸ï¼Œè½»æ¾èŠ‚å¥'"
        }
      }
    },
    {
      "name": "api_rate_limit_guard",
      "description": "API-level rate limiter should return 429 under burst traffic.",
      "passed": true,
      "detail": "statuses=[200, 200, 429, 429, 429, 429]",
      "elapsed_ms": 27992.09,
      "evidence": {
        "statuses": [
          200,
          200,
          429,
          429,
          429,
          429
        ]
      }
    }
  ],
  "failed": []
}
